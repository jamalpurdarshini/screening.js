<!DOCTYPE html>
<html>
<head>
  <title>TODO List</title>
</head>
<body>
  <h2>TODO List</h2>
  <button onclick="logout()">Logout</button><br><br>

  <input id="taskInput" placeholder="Add task" />
  <button onclick="addTask()">Add</button>

  <ul id="taskList"></ul>

  <script>
    // Get the current username from localStorage
    const user = localStorage.getItem("currentUser");
    if (!user) {
      window.location.href = "login.html"; // Redirect if not logged in
    }

    // Dynamically create the localStorage key based on the username
    function getTaskKey() {
      return user;  // Use the username directly as the key
    }

    // Add task to the list and to localStorage
    function addTask() {
      const input = document.getElementById("taskInput");
      const task = input.value.trim();
      if (!task) return;

      const li = document.createElement("li");
      li.innerHTML = `${task} 
        <button onclick="editTask(this)">Edit</button>
        <button onclick="deleteTask(this)">Delete</button>`;
      document.getElementById("taskList").appendChild(li);

      saveToLocal(task);  // Save task to localStorage
      input.value = "";    // Clear input field
    }

    // Save tasks to localStorage for the current user
    function saveToLocal(task) {
      const key = getTaskKey();  // Use username directly as the key
      const tasks = JSON.parse(localStorage.getItem(key)) || [];
      tasks.push(task);  // Add task to array
      localStorage.setItem(key, JSON.stringify(tasks));  // Save array back to localStorage
    }

    // Edit task
    function editTask(button) {
      const li = button.parentElement;
      const current = li.firstChild.textContent.trim();
      const updated = prompt("Edit task", current);
      if (updated) {
        li.firstChild.textContent = updated + " ";
        // No need to update localStorage here, as task is edited only on screen
      }
    }

    // Delete task (only removes from screen, not localStorage)
    function deleteTask(button) {
      const li = button.parentElement;
      li.remove();  // Remove task from the screen

      // If we wanted to remove from localStorage too, we would update the array in localStorage.
      // But according to your requirements, we're not removing it from localStorage yet.
    }

    // Load tasks from localStorage
    function loadTasks() {
      const key = getTaskKey();
      const tasks = JSON.parse(localStorage.getItem(key)) || [];

      tasks.forEach(task => {
        const li = document.createElement("li");
        li.innerHTML = `${task} 
          <button onclick="editTask(this)">Edit</button>
          <button onclick="deleteTask(this)">Delete</button>`;
        document.getElementById("taskList").appendChild(li);
      });
    }

    // Logout function to clear session
    function logout() {
      localStorage.removeItem("currentUser");  // Clear current user
      window.location.href = "login.html";  // Redirect to login page
    }

    window.onload = loadTasks;  // Load tasks when the page loads
  </script>
</body>
</html>


